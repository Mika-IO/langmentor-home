<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Langmentor AI</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <script>
            // Configura√ß√£o para personalizar a cor prim√°ria
            tailwind.config = {
                theme: {
                    extend: {
                        colors: {
                            primary: "#0F8AFD", // Nova cor prim√°ria
                        },
                    },
                },
            };
        </script>
    </head>
    <body class="bg-white">
        <!-- Navbar -->
        <nav class="bg-primary p-2 md:p-4">
            <div class="container mx-auto flex justify-between items-center">
                <div class="flex items-center space-x-2">
                    <img src="icon.svg" alt="Icon" class="w-8 h-8" />
                    <h1 class="text-white text-center text-xl md:text-2xl font-bold">LangmentorAI</h1>
                </div>
                <button class="bg-white text-primary font-semibold px-2 py-1 md:px-4 md:py-2 rounded hover:bg-gray-200 text-sm md:text-base">
                    Login Google
                </button>
            </div>
        </nav>
        <!-- Tabs -->
        <div class="bg-white shadow-md">
            <div class="container mx-auto px-4 py-2 flex space-x-4 overflow-x-auto whitespace-nowrap">
                <a href="#" class="text-primary border-b-4 border-primary font-semibold pb-2">Game</a>
                <a href="#" class="text-gray-600 hover:text-primary pb-2">Search</a>
                <a href="#" class="text-gray-600 hover:text-primary pb-2">Community</a>
                <a href="#" class="text-gray-600 hover:text-primary pb-2">Pricing</a>
                <a href="#" class="text-gray-600 hover:text-primary pb-2">Profile</a>
            </div>
        </div>
        <!-- Game Content -->
        <div class="container mx-auto mt-6 p-6 shadow-lg rounded-lg">
            <div class="p-4">
                <div class="mb-2 text-orange-500 font-bold">Learning English</div>
                <!-- Frase em ingl√™s com a lacuna -->
                <p id="sentence" class="text-xl font-semibold text-primary mb-4">
                    Where are you? ‚Äì I am at
                    <input
                        id="answer-input"
                        type="text"
                        class="border-b-2 border-gray-400 focus:border-primary outline-none text-center"
                        style="width: 5ch; max-width: 30ch;"
                        oninput="this.style.width = (this.value.length > 0 ? this.value.length : 5) + 'ch';"
                    />
                </p>
                <!-- Tipo da palavra -->
                <div class="bg-gray-100 rounded-full px-4 py-2 text-gray-700 inline-block">substantivo, singular</div>
            </div>
            <!-- Frase completa em portugu√™s -->
            <div class="bg-gray-100 p-4 text-gray-700 mt-4 rounded-lg">
                <p id="sentence-pt" class="text-gray-500">Onde voc√™ est√°? Eu estou em casa.</p>
            </div>
            <!-- Bot√£o de aprendizado -->
            <div class="flex justify-end p-4 mt-4">
                <button id="check-btn" class="bg-primary text-white px-4 py-2 rounded-full hover:bg-opacity-90">
                    Verificar
                </button>
                <button id="next-btn" class="bg-green-500 text-white px-4 py-2 rounded-full hover:bg-green-600 hidden">
                    Pr√≥xima
                </button>
                <button id="show-answer-btn" class="bg-primary text-white px-4 py-2 rounded-full hover:bg-opacity-90 hidden ml-4">
                    Ver resposta
                </button>
            </div>
            <!-- Mensagem de feedback (correta ou incorreta) -->
            <div id="feedback-message" class="hidden text-center mt-4"></div>
        </div>

        <script src="sentences.js"></script>
        <script>

            // Fun√ß√£o para selecionar a pr√≥xima frase com certa aleatoriedade ponderada
            function getNextSentenceIndex() {
                // Calcular a diferen√ßa entre erros e acertos para cada frase e gerar pesos
                const sentenceWeights = sentences.map((sentence, index) => {
                    const difference = sentence.errors - sentence.correct; // Diferen√ßa entre erros e acertos
                    const weight = Math.max(difference + 1, 1); // Evitar peso negativo, m√≠nimo 1
                    return { index, weight };
                });

                // Somar os pesos para calcular a distribui√ß√£o
                const totalWeight = sentenceWeights.reduce((sum, sentence) => sum + sentence.weight, 0);

                // Gerar um valor aleat√≥rio baseado na soma dos pesos
                const random = Math.random() * totalWeight;

                // Selecionar a frase com base no valor aleat√≥rio e nos pesos
                let cumulativeWeight = 0;
                for (let i = 0; i < sentenceWeights.length; i++) {
                    cumulativeWeight += sentenceWeights[i].weight;
                    if (random < cumulativeWeight) {
                        return sentenceWeights[i].index;
                    }
                }
                return sentenceWeights[0].index; // Retornar a primeira frase como fallback
            }

            let currentSentenceIndex = getNextSentenceIndex(); // Inicializa com a frase aleat√≥ria ponderada

            const sentenceElement = document.getElementById("sentence");
            const sentencePtElement = document.getElementById("sentence-pt");
            const feedbackMessage = document.getElementById("feedback-message");
            const checkButton = document.getElementById("check-btn");
            const nextButton = document.getElementById("next-btn");
            const showAnswerButton = document.getElementById("show-answer-btn");

            function loadSentence() {
                const currentSentence = sentences[currentSentenceIndex];

                // Cria a frase completa para ser usada na fala, substituindo "____" pela resposta correta.
                const completeSentence = currentSentence.sentence.replace("____", currentSentence.answer);

                sentenceElement.innerHTML = `
                    <button id="speak-btn" class="ml-2 text-white p-1 rounded">üîä</button><br>
                    ${currentSentence.sentence.replace(
                        "____",
                        '<input id="answer-input" type="text" class="border-b-2 border-gray-400 focus:border-primary outline-none text-center" style="width: 4ch; max-width: 10ch;" oninput="this.style.width = Math.min(this.value.length, 15) + \'ch\';">'
                    )}
                `;

                const input = document.getElementById("answer-input");
                input.focus();

                sentencePtElement.textContent = currentSentence.sentencePt;
                feedbackMessage.classList.add("hidden");
                nextButton.classList.add("hidden");
                checkButton.classList.remove("hidden");
                showAnswerButton.classList.add("hidden");

                speakSentence(completeSentence);

                // Adicionar evento ao bot√£o de fala
                document.getElementById("speak-btn").addEventListener("click", () => {
                    speakSentence(completeSentence);
                });

                // Adicionar evento para verificar a resposta ao pressionar Enter
                const answerInput = document.getElementById("answer-input");
                answerInput.addEventListener("keypress", (event) => {
                    console.log("enter");
                    if (event.key === "Enter") {
                        // Verifica quais bot√µes est√£o vis√≠veis e chama a fun√ß√£o apropriada
                        if (!checkButton.classList.contains("hidden") && showAnswerButton.classList.contains("hidden")) {
                            console.log("check");
                            checkAnswer(); // Se apenas o bot√£o de verificar est√° ativo, verifica a resposta
                            return;
                        }
                        if (!showAnswerButton.classList.contains("hidden")) {
                            console.log("show");
                            showAnswer(); // Esconde o bot√£o de mostrar resposta
                            return;
                        }
                        if (!nextButton.classList.contains("hidden")) {
                            console.log("next");
                            currentSentenceIndex = getNextSentenceIndex(); // Seleciona a pr√≥xima frase com aleatoriedade ponderada
                            loadSentence(); // Carrega a pr√≥xima frase
                        }
                    }
                });
            }

            // Fun√ß√£o para verificar a resposta
            function checkAnswer() {
                const userAnswer = document.getElementById("answer-input").value.toLowerCase().trim();
                const currentSentence = sentences[currentSentenceIndex];
                const correctAnswer = currentSentence.answer.toLowerCase();

                if (userAnswer === correctAnswer) {
                    feedbackMessage.textContent = "Resposta correta!";
                    feedbackMessage.classList.remove("hidden");
                    feedbackMessage.classList.add("text-green-500");
                    feedbackMessage.classList.remove("text-red-500");

                    // Incrementa o n√∫mero de acertos
                    currentSentence.correct += 1;

                    checkButton.classList.add("hidden");
                    nextButton.classList.remove("hidden");
                } else {
                    feedbackMessage.textContent = "Resposta incorreta!";
                    feedbackMessage.classList.remove("hidden");
                    feedbackMessage.classList.add("text-red-500");
                    feedbackMessage.classList.remove("text-green-500");

                    // Incrementa o n√∫mero de erros
                    currentSentence.errors += 1;

                    showAnswerButton.classList.remove("hidden");
                }
            }

            // Evento do bot√£o de verificar resposta
            checkButton.addEventListener("click", checkAnswer);

            // Evento do bot√£o pr√≥xima frase
            nextButton.addEventListener("click", () => {
                currentSentenceIndex = getNextSentenceIndex(); // Seleciona a pr√≥xima frase com aleatoriedade ponderada
                loadSentence();
            });

            function showAnswer() {
                const currentSentence = sentences[currentSentenceIndex];
                input = document.getElementById("answer-input")
                input.value = currentSentence.answer;
                input.style.width = Math.min(currentSentence.answer.length + 1, 15) + 'ch';

                // Incrementa o n√∫mero de vezes que a resposta foi vista
                currentSentence.views += 1;

                showAnswerButton.classList.add("hidden");

                
            }

            // Evento para mostrar a resposta
            showAnswerButton.addEventListener("click", () => {
                showAnswer();
            });

            // Fun√ß√£o de falar usada anteriormente
            function speak(text) {
                const speech = new SpeechSynthesisUtterance(text);
                speech.lang = "en-US";
                speech.rate = 1; // Velocidade da fala
                speech.pitch = 1; // Tom da voz
                speech.volume = 1; // Volume (0 a 1)

                // Seleciona a voz mais natural
                const voices = speechSynthesis.getVoices();
                const naturalVoice = voices.find((voice) => voice.name.includes("Google US English")); // Altere o nome conforme necess√°rio

                if (naturalVoice) {
                    speech.voice = naturalVoice;
                }

                window.speechSynthesis.speak(speech);
            }

            // Fun√ß√£o adaptada para usar a mesma voz ao falar uma frase
            function speakSentence(sentence) {
                if ("speechSynthesis" in window) {
                    const utterance = new SpeechSynthesisUtterance(sentence);
                    utterance.lang = "en-US"; // Configura o idioma para ingl√™s
                    utterance.rate = 1;
                    utterance.pitch = 1;
                    utterance.volume = 1;

                    // Seleciona a voz mais natural, como na fun√ß√£o speak
                    const voices = speechSynthesis.getVoices();
                    const naturalVoice = voices.find((voice) => voice.name.includes("Google US English")); // Altere conforme necess√°rio

                    if (naturalVoice) {
                        console.log("natural");
                        utterance.voice = naturalVoice;
                    }

                    window.speechSynthesis.speak(utterance);
                } else {
                    console.log("Seu navegador n√£o suporta Text-to-Speech.");
                }
            }
            speakSentence("Welcome langmentor AI");

            // Inicializar o jogo carregando a primeira frase
            loadSentence();

			if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js').then((registration) => {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                }, (error) => {
                    console.log('ServiceWorker registration failed: ', error);
                });
            });
        }
        </script>
    </body>
</html>
